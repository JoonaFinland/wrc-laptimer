<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WRC Laptimer</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="index.js" type="module"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body>
    <aside>
      <div class="bg-image"></div>
      <div x-data class="main">
        <!-- Current Driver Section -->
        <header class="current-driver">
          <span class="label">Current Driver:</span>
          <span
            x-data
            x-text="$store.currentDriver.name"
            class="driver-name"
          ></span>
        </header>

        <!-- Event Info Section -->
        <div class="event-header">
          <h1>Leaderboard</h1>
        </div>
        <div x-data="controller" class="event-info">
          <div class="event-details">
            <div class="date-box">
              <span class="btn" @click="changeDay(-1)"><</span>
              <span class="stage-date" x-text="$store.event.date"></span>
              <span class="btn" @click="changeDay(1)">></span>
            </div>
            <span class="stage-info">
              <span x-text="$store.event.stage"></span> -
              <span x-text="$store.event.location"></span>
            </span>
            <span class="car-class">
              <span class="car-car" x-text="$store.event.car"></span>
              (<span x-text="$store.event.class"></span>)
            </span>
          </div>
        </div>

        <!-- Leaderboard Table -->
        <table class="leaderboard">
          <thead>
            <tr>
              <th>POS.</th>
              <th>Driver</th>
              <th>Tries</th>
              <th>Time</th>
              <th>Diff</th>
            </tr>
          </thead>
          <tbody x-data="controller">
            <template
              x-for="(laptime, index) in $store.laptimer.laptimes"
              :key="laptime.position"
            >
              <tr
                :class="index === $store.laptimer.latestDriveIndex ? 'highlight' : ''"
                @click="showDriverAttempts(laptime.name)"
                style="cursor: pointer"
              >
                <td x-text="laptime.position"></td>
                <td x-text="laptime.name"></td>
                <td x-text="laptime.attempts"></td>
                <td x-text="laptime.time"></td>
                <td x-text="laptime.diff"></td>
              </tr>
            </template>
          </tbody>
        </table>

        <!-- Modal for Driver Attempts -->
        <div
          x-data="controller"
          class="modal"
          style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
          "
        >
          <div
            class="modal-content"
            style="
              background: #333;
              margin: 10% auto;
              padding: 20px;
              width: 50%;
              border-radius: 8px;
            "
          >
            <h2
              x-text="`${$store.driverAttempts.selectedDriver}'s Attempts`"
            ></h2>
            <table class="driver-attempts">
              <thead>
                <tr>
                  <th>Attempt #</th>
                  <th>Time</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <template
                  x-for="(attempt, index) in $store.driverAttempts.driverAttempts"
                  :key="index"
                >
                  <tr>
                    <td x-text="index + 1"></td>
                    <td x-text="attempt.time"></td>
                    <td x-text="attempt.status"></td>
                  </tr>
                </template>
              </tbody>
            </table>
            <button x-data="controller" @click="closeModal()">Close</button>
          </div>
        </div>
      </div>
    </aside>
  </body>
</html>
